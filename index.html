<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de OANSINES - OANSA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primary: #1e4b7c;
            --color-secondary: #3b6999;
            --color-accent: #ff6b6b;
            --color-success: #28a745;
            --color-background: #f8f9fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--color-accent) 0%, #ff8e53 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .storage-info {
            background-color: #e7f3ff;
            padding: 10px 20px;
            text-align: center;
            border-bottom: 1px solid #b6d4fe;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .storage-info button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .header-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            padding: 20px;
            background-color: var(--color-background);
            border-bottom: 1px solid #dee2e6;
        }
        
        .club-info, .date-info {
            flex: 1;
            min-width: 300px;
            margin: 10px;
        }
        
        .club-info input, .date-info input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            margin-top: 5px;
        }
        
        .categories {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            background-color: #e9ecef;
            justify-content: center;
        }
        
        .category {
            background: white;
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .category-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--color-primary);
        }
        
        .category-value {
            font-size: 1.2rem;
            color: var(--color-success);
        }
        
        .table-container {
            overflow-x: auto;
            padding: 0 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: center;
        }
        
        th {
            background-color: var(--color-primary);
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: var(--color-background);
        }
        
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        
        input[type="checkbox"] {
            transform: scale(1.3);
            cursor: pointer;
        }
        
        input[type="date"] {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            background-color: var(--color-background);
            border-top: 1px solid #dee2e6;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--color-success) 0%, #20c997 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .summary {
            padding: 20px;
            background-color: #e9ecef;
            border-top: 1px solid #dee2e6;
        }
        
        .summary h3 {
            margin-bottom: 15px;
            color: var(--color-primary);
            text-align: center;
        }
        
        .summary-content {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .summary-item {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 200px;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--color-primary);
            margin-top: 5px;
        }
        
        .instructions {
            padding: 20px;
            background-color: var(--color-background);
            border-top: 1px solid #dee2e6;
            margin-top: 20px;
            border-radius: 0 0 15px 15px;
        }
        
        .instructions h3 {
            color: var(--color-primary);
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .export-section {
            padding: 20px;
            text-align: center;
            background-color: #e7f3ff;
            border-top: 1px solid #b6d4fe;
        }
        
        @media (max-width: 768px) {
            .header-info {
                flex-direction: column;
            }
            
            th, td {
                padding: 8px 5px;
                font-size: 0.9rem;
            }
            
            .category {
                min-width: 120px;
                padding: 10px;
            }
            
            button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Control de OANSINES</h1>
            <div class="subtitle">Programa OANSA - Sistema de seguimiento de Oansines</div>
        </header>
        
        <div class="storage-info">
            <span id="storage-status">Datos guardados localmente en este navegador</span>
            <button id="export-btn"><i class="fas fa-download"></i> Exportar</button>
        </div>
        
        <div class="header-info">
            <div class="club-info">
                <label for="club-name">Nombre del Club:</label>
                <input type="text" id="club-name" placeholder="Ej: Club Ositos">
            </div>
            <div class="club-info">
                <label for="leader-name">Líder Responsable:</label>
                <input type="text" id="leader-name" placeholder="Tu nombre :)">
            </div>
            <div class="date-info">
                <label for="session-date">Fecha de la Sesión:</label>
                <input type="date" id="session-date">
            </div>
        </div>
        
        <div class="categories">
            <div class="category">
                <div class="category-title">Sección</div>
                <div class="category-value">20 oansines</div>
            </div>
            <div class="category">
                <div class="category-title">Biblia</div>
                <div class="category-value">20 oansines</div>
            </div>
            <div class="category">
                <div class="category-title">Asistencia</div>
                <div class="category-value">10 oansines</div>
            </div>
            <div class="category">
                <div class="category-title">Puntualidad</div>
                <div class="category-value">10 oansines</div>
            </div>
            <div class="category">
                <div class="category-title">Visitas</div>
                <div class="category-value">100 oansines c/u</div>
            </div>
            <div class="category">
                <div class="category-title">Uniforme</div>
                <div class="category-value">20 oansines</div>
            </div>
        </div>
        
        <div class="table-container">
            <table id="main-table">
                <thead>
                    <tr>
                        <th>Nombre del Niño/a</th>
                        <th>Sección</th>
                        <th>Biblia</th>
                        <th>Asistencia</th>
                        <th>Puntualidad</th>
                        <th>Visitas</th>
                        <th>Uniforme</th>
                        <th>Total Oansines</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Nombre completo" class="name-input"></td>
                        <td><input type="checkbox" class="section"></td>
                        <td><input type="checkbox" class="bible"></td>
                        <td><input type="checkbox" class="attendance"></td>
                        <td><input type="checkbox" class="punctuality"></td>
                        <td><input type="number" min="0" value="0" class="visits"></td>
                        <td><input type="checkbox" class="uniform"></td>
                        <td class="total">0</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="actions">
            <button id="add-row" class="btn-primary">
                <i class="fas fa-plus-circle"></i> Añadir Niño/a
            </button>
            <button id="save-btn" class="btn-success">
                <i class="fas fa-save"></i> Guardar Datos
            </button>
            <button id="print-btn" class="btn-primary">
                <i class="fas fa-print"></i> Imprimir Hoja
            </button>
            <button id="reset-btn" class="btn-danger">
                <i class="fas fa-redo"></i> Nueva Hoja
            </button>
        </div>
        
        <div class="summary">
            <h3>Resumen de la Sesión</h3>
            <div class="summary-content">
                <div class="summary-item">
                    <div>Total de niños participantes</div>
                    <div class="summary-value" id="total-children">1</div>
                </div>
                <div class="summary-item">
                    <div>Total de oansines entregados</div>
                    <div class="summary-value" id="total-oansines">0</div>
                </div>
            </div>
        </div>
        
        <div class="export-section">
            <h3>Respaldo de Datos</h3>
            <p>Para mayor seguridad, puedes exportar tus datos y guardarlos en otro lugar</p>
            <button id="backup-btn" class="btn-success">
                <i class="fas fa-file-export"></i> Crear Copia de Seguridad
            </button>
        </div>
        
        <div class="instructions">
            <h3>Instrucciones de uso:</h3>
            <ul>
                <li>Los datos se guardan automáticamente en tu navegador</li>
                <li>Puedes usar la aplicación sin conexión a internet</li>
                <li>Para no perder los datos, no limpies el historial de tu navegador</li>
                <li>Exporta regularmente una copia de seguridad</li>
                <li>Los datos sólo están disponibles en este navegador y dispositivo</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.getElementById('main-table');
            const addRowBtn = document.getElementById('add-row');
            const printBtn = document.getElementById('print-btn');
            const saveBtn = document.getElementById('save-btn');
            const resetBtn = document.getElementById('reset-btn');
            const exportBtn = document.getElementById('export-btn');
            const backupBtn = document.getElementById('backup-btn');
            const storageStatus = document.getElementById('storage-status');
            
            // NUEVOS VALORES DE OANSINES
            const valoresOansines = {
                seccion: 20,
                biblia: 20,
                asistencia: 10,
                puntualidad: 10,
                visita: 100,
                uniforme: 20
            };
            
            // Establecer fecha actual por defecto
            const today = new Date();
            const formattedDate = today.toISOString().substr(0, 10);
            document.getElementById('session-date').value = formattedDate;
            
            // Verificar soporte para localStorage
            function supportsLocalStorage() {
                try {
                    return 'localStorage' in window && window['localStorage'] !== null;
                } catch (e) {
                    return false;
                }
            }
            
            if (!supportsLocalStorage()) {
                storageStatus.textContent = "Tu navegador no soporta almacenamiento local. Los datos no se guardarán.";
                storageStatus.style.color = "red";
            }
            
            // Añadir nueva fila
            addRowBtn.addEventListener('click', function() {
                const tbody = table.querySelector('tbody');
                const newRow = tbody.rows[0].cloneNode(true);
                
                // Limpiar los valores de la nueva fila
                newRow.querySelector('.name-input').value = '';
                newRow.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                newRow.querySelector('.visits').value = '0';
                newRow.querySelector('.total').textContent = '0';
                
                tbody.appendChild(newRow);
                updateTotals();
                
                // Añadir evento para recalcular cuando cambie cualquier valor
                attachEventListenersToRow(newRow);
                saveData(); // Guardar automáticamente
            });
            
            // Función para adjuntar eventos a una fila
            function attachEventListenersToRow(row) {
                const inputs = row.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('change', function() {
                        updateRowTotal.call(this);
                        saveData(); // Guardar automáticamente después de cada cambio
                    });
                });
            }
            
            // Adjuntar eventos a la fila inicial
            const initialRow = table.querySelector('tbody tr');
            attachEventListenersToRow(initialRow);
            
            // Calcular total por fila - MODIFICADA CON NUEVOS VALORES
            function updateRowTotal() {
                const row = this.closest('tr');
                
                // CÁLCULO CON LOS NUEVOS VALORES
                const section = row.querySelector('.section').checked ? valoresOansines.seccion : 0;
                const bible = row.querySelector('.bible').checked ? valoresOansines.biblia : 0;
                const attendance = row.querySelector('.attendance').checked ? valoresOansines.asistencia : 0;
                const punctuality = row.querySelector('.punctuality').checked ? valoresOansines.puntualidad : 0;
                const visits = parseInt(row.querySelector('.visits').value) * valoresOansines.visita;
                const uniform = row.querySelector('.uniform').checked ? valoresOansines.uniforme : 0;
                
                const total = section + bible + attendance + punctuality + visits + uniform;
                row.querySelector('.total').textContent = total;
                
                updateTotals();
            }
            
            // Actualizar totales generales
            function updateTotals() {
                const rows = table.querySelectorAll('tbody tr');
                let totalOansines = 0;
                
                rows.forEach(row => {
                    totalOansines += parseInt(row.querySelector('.total').textContent);
                });
                
                document.getElementById('total-children').textContent = rows.length;
                document.getElementById('total-oansines').textContent = totalOansines;
            }
            
            // Guardar datos
            function saveData() {
                if (!supportsLocalStorage()) return;
                
                // Crear objeto con los datos
                const clubData = {
                    clubName: document.getElementById('club-name').value,
                    leaderName: document.getElementById('leader-name').value,
                    sessionDate: document.getElementById('session-date').value,
                    children: []
                };
                
                // Recopilar datos de cada niño
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const name = row.querySelector('.name-input').value;
                    if (name) {
                        clubData.children.push({
                            name: name,
                            section: row.querySelector('.section').checked,
                            bible: row.querySelector('.bible').checked,
                            attendance: row.querySelector('.attendance').checked,
                            punctuality: row.querySelector('.punctuality').checked,
                            visits: parseInt(row.querySelector('.visits').value),
                            uniform: row.querySelector('.uniform').checked,
                            total: parseInt(row.querySelector('.total').textContent)
                        });
                    }
                });
                
                // Guardar en localStorage
                localStorage.setItem('awanaOansinesData', JSON.stringify(clubData));
                
                // Actualizar estado
                storageStatus.textContent = "Datos guardados: " + new Date().toLocaleTimeString();
                setTimeout(() => {
                    storageStatus.textContent = "Datos guardados localmente en este navegador";
                }, 3000);
            }
            
            // Configurar autoguardado en los campos de entrada
            document.getElementById('club-name').addEventListener('input', saveData);
            document.getElementById('leader-name').addEventListener('input', saveData);
            document.getElementById('session-date').addEventListener('change', saveData);
            
            // Guardar datos con el botón
            saveBtn.addEventListener('click', saveData);
            
            // Imprimir hoja
            printBtn.addEventListener('click', function() {
                window.print();
            });
            
            // Exportar datos
            exportBtn.addEventListener('click', function() {
                const data = localStorage.getItem('awanaOansinesData');
                if (!data) {
                    alert("No hay datos para exportar");
                    return;
                }
                
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'awana_oansines_backup.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // Crear copia de seguridad
            backupBtn.addEventListener('click', function() {
                saveData(); // Asegurarse de que los datos están actualizados
                exportBtn.click(); // Simular clic en exportar
                
                // Mostrar mensaje
                storageStatus.textContent = "Copia de seguridad creada: " + new Date().toLocaleTimeString();
                setTimeout(() => {
                    storageStatus.textContent = "Datos guardados localmente en este navegador";
                }, 3000);
            });
            
            // Cargar datos guardados
            function loadSavedData() {
                if (!supportsLocalStorage()) return;
                
                const savedData = localStorage.getItem('awanaOansinesData');
                if (savedData) {
                    try {
                        const clubData = JSON.parse(savedData);
                        
                        document.getElementById('club-name').value = clubData.clubName || '';
                        document.getElementById('leader-name').value = clubData.leaderName || '';
                        document.getElementById('session-date').value = clubData.sessionDate || formattedDate;
                        
                        // Limpiar tabla
                        const tbody = table.querySelector('tbody');
                        tbody.innerHTML = '';
                        
                        // Añadir niños guardados
                        if (clubData.children && clubData.children.length > 0) {
                            clubData.children.forEach(child => {
                                const newRow = document.createElement('tr');
                                newRow.innerHTML = `
                                    <td><input type="text" placeholder="Nombre completo" class="name-input" value="${child.name}"></td>
                                    <td><input type="checkbox" class="section" ${child.section ? 'checked' : ''}></td>
                                    <td><input type="checkbox" class="bible" ${child.bible ? 'checked' : ''}></td>
                                    <td><input type="checkbox" class="attendance" ${child.attendance ? 'checked' : ''}></td>
                                    <td><input type="checkbox" class="punctuality" ${child.punctuality ? 'checked' : ''}></td>
                                    <td><input type="number" min="0" value="${child.visits}" class="visits"></td>
                                    <td><input type="checkbox" class="uniform" ${child.uniform ? 'checked' : ''}></td>
                                    <td class="total">${child.total}</td>
                                `;
                                tbody.appendChild(newRow);
                                attachEventListenersToRow(newRow);
                            });
                        } else {
                            // Añadir una fila vacía si no hay datos de niños
                            addInitialRow();
                        }
                        
                        updateTotals();
                    } catch (e) {
                        console.error("Error loading saved data", e);
                        addInitialRow();
                    }
                } else {
                    addInitialRow();
                }
            }
            
            function addInitialRow() {
                const tbody = table.querySelector('tbody');
                tbody.innerHTML = '';
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" placeholder="Nombre completo" class="name-input"></td>
                    <td><input type="checkbox" class="section"></td>
                    <td><input type="checkbox" class="bible"></td>
                    <td><input type="checkbox" class="attendance"></td>
                    <td><input type="checkbox" class="punctuality"></td>
                    <td><input type="number" min="0" value="0" class="visits"></td>
                    <td><input type="checkbox" class="uniform"></td>
                    <td class="total">0</td>
                `;
                tbody.appendChild(newRow);
                attachEventListenersToRow(newRow);
            }
            
            // Cargar datos al iniciar
            loadSavedData();
            
            // Reiniciar hoja
            resetBtn.addEventListener('click', function() {
                if (confirm('¿Estás seguro de que quieres comenzar una nueva hoja? Se perderán todos los datos no guardados.')) {
                    localStorage.removeItem('awanaOansinesData');
                    
                    const tbody = table.querySelector('tbody');
                    tbody.innerHTML = '';
                    
                    // Añadir una fila vacía
                    addInitialRow();
                    
                    // Limpiar información de la cabecera
                    document.getElementById('club-name').value = '';
                    document.getElementById('leader-name').value = '';
                    
                    // Restablecer la fecha a hoy
                    document.getElementById('session-date').value = formattedDate;
                    
                    updateTotals();
                    saveData();
                }
            });
        });
    </script>
</body>
</html>
